<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Earning App Pro</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <script src="https://ad.gigapub.tech/script?id=1547"></script>
    <script type="text/javascript" src="https://cdn.tgads.space/assets/js/adexium-widget.min.js"></script>
    <script src='//libtl.com/sdk.js' data-zone='9726274' data-sdk='show_9726274'></script>
    
    <style>
        :root {
            --primary-color: #5E5CE6;
            --secondary-color: #00C6FF;
            --green-color: #34C759;
            --background-color: #F0F2F5;
            --card-background: #FFFFFF;
            --text-color: #1D1D1F;
            --text-secondary-color: #6E6E73;
            --font-family: 'Poppins', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: var(--font-family); background: var(--background-color); color: var(--text-color); overflow-x: hidden; }
        .container { max-width: 400px; margin: 0 auto; background: var(--card-background); min-height: 100vh; }

        /* Header */
        .header { background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)); color: white; padding: 20px; display: flex; align-items: center; justify-content: space-between; position: sticky; top: 0; z-index: 100; }
        .header-profile { width: 45px; height: 45px; border-radius: 50%; border: 2px solid rgba(255, 255, 255, 0.7); }
        .header-info h3 { font-size: 18px; font-weight: 600; }
        .header-info p { font-size: 14px; opacity: 0.9; }

        /* Main Card */
        .main-card { background: var(--card-background); border-radius: 24px; padding: 25px; margin: 20px; box-shadow: 0 10px 40px rgba(0, 0, 0, 0.08); }
        .balance-display { text-align: center; margin-bottom: 25px; }
        .balance-value { font-size: 44px; font-weight: 700; color: var(--primary-color); }
        .balance-label { font-size: 14px; color: var(--text-secondary-color); }
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; text-align: center; }
        .stat-item h3 { font-size: 20px; font-weight: 600; }
        .stat-item p { font-size: 12px; color: var(--text-secondary-color); }

        /* Task Section */
        .task-list h2 { font-size: 20px; font-weight: 600; color: var(--text-color); margin-bottom: 20px; }
        .task-item { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; font-size: 16px; }
        .task-label { font-weight: 500; color: var(--text-secondary-color); }
        .task-value { font-weight: 600; color: var(--primary-color); }
        .task-progress { background: #EAEAEA; border-radius: 10px; height: 10px; margin-top: 15px; overflow: hidden; }
        .progress-bar { background: linear-gradient(90deg, var(--primary-color), var(--secondary-color)); height: 100%; border-radius: 10px; transition: width 0.5s ease-in-out; }
        
        .action-button { background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)); color: white; border: none; padding: 16px; border-radius: 16px; font-size: 16px; font-weight: 600; cursor: pointer; width: 100%; margin-top: 20px; box-shadow: 0 8px 25px rgba(94, 92, 230, 0.3); transition: all 0.3s ease; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .action-button.green { background: linear-gradient(135deg, var(--green-color), #28a745); box-shadow: 0 8px 25px rgba(52, 199, 89, 0.3); }
        .action-button:hover { transform: translateY(-3px); }
        .action-button:disabled { background: #B0B0B0; cursor: not-allowed; box-shadow: none; }

        /* Pages & Navigation */
        .page { display: none; padding: 0 0 100px 0; animation: fadeIn 0.5s; }
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .bottom-nav { position: fixed; bottom: 0; left: 50%; transform: translateX(-50%); width: 100%; max-width: 400px; background: rgba(255, 255, 255, 0.8); backdrop-filter: blur(10px); border-top: 1px solid #EAEAEA; display: flex; justify-content: space-around; padding: 10px 0; z-index: 100; }
        .nav-item { text-align: center; cursor: pointer; color: #A0A0A0; transition: color 0.3s ease; flex: 1; }
        .nav-item.active { color: var(--primary-color); }
        .nav-item svg { width: 26px; height: 26px; fill: currentColor; }
        .nav-label { font-size: 10px; font-weight: 500; margin-top: 4px; }

        /* Loader & Toast */
        .loader-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255, 255, 255, 0.9); display: flex; align-items: center; justify-content: center; z-index: 9999; }
        .loader { border: 4px solid #f3f3f3; border-top: 4px solid var(--primary-color); border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .toast { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); background: #2c3e50; color: white; padding: 12px 20px; border-radius: 10px; font-size: 14px; z-index: 1001; opacity: 0; transition: opacity 0.3s, top 0.3s; }
        .toast.show { opacity: 1; top: 30px; }
        
        /* Other styles */
        .form-input { width: 100%; padding: 15px; border: 1px solid #ddd; border-radius: 12px; background: #fafafa; font-size: 16px; }
        .info-card { background: var(--card-background); border-radius: 16px; padding: 20px; margin: 0 20px 20px; box-shadow: 0 4px 20px rgba(0,0,0,0.05); }
    </style>
</head>
<body>
    <div id="loader" class="loader-overlay"><div class="loader"></div></div>

    <div class="container" style="display: none;">
        <div class="header"></div>
        
        <div id="homePage" class="page active">
            <div class="main-card">
                <div class="balance-display">
                    <p class="balance-label">Total Balance</p>
                    <p class="balance-value"><span id="totalBalanceAmount">0</span></p>
                </div>
                <div class="stats-grid">
                    <div class="stat-item"><h3 id="balanceTotal">0</h3><p>Total Points</p></div>
                    <div class="stat-item"><h3 id="balanceEarning">0</h3><p>Total Earning</p></div>
                </div>
            </div>
            <div class="main-card task-list">
                <h2>Today's Tasks</h2>
                <div class="task-item">
                    <span class="task-label">Completed:</span>
                    <span class="task-value"><span id="dailyTasksCompleted">0</span> / <span id="dailyTaskLimit">50</span></span>
                </div>
                <div class="task-progress"><div class="progress-bar" id="progressBar" style="width: 0%;"></div></div>
                <button class="action-button" onclick="navigateTo('earnPage')">▶ Start Earning</button>
            </div>
        </div>

        <div id="earnPage" class="page">
             <div class="main-card">
                <h2>Earn Rewards</h2>
                <p style="color: var(--text-secondary-color); font-size: 14px; margin-top: 5px;">Complete tasks to earn points. <span id="earnDailyTasksRemaining">50</span> tasks remaining today.</p>
                 <div class="task-progress" style="margin-top: 20px;"><div class="progress-bar" id="earnProgressBar" style="width: 0%;"></div></div>
                
                <button class="action-button" id="popUpAdBtn">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="white"><path d="M8 5v14l11-7z"/></svg>
                    <span>Watch Pop-up Ad</span>
                </button>
                <button class="action-button green" id="linkAdBtn">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="white"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"/></svg>
                    <span>Visit Link Ad</span>
                </button>
            </div>
        </div>

        <div id="withdrawPage" class="page">
             </div>

        <div id="profilePage" class="page">
            </div>

        <div class="bottom-nav"></div>
    </div>

    <div class="toast" id="toast">Message</div>
    
    <script>
        const tg = window.Telegram.WebApp;
        tg.ready();
        tg.expand();
        
        // --- CONFIGURATION ---
        const botUsername = 'Airdrop_zon_Bot'; 
        const API_BASE_URL = 'https://your-backend-url.com/api'; 
        const supportLink = 'https://t.me/your_support_username'; // <-- গুরুত্বপূর্ণ: আপনার সাপোর্ট চ্যাটের লিঙ্ক দিন
        const linkAdUrl = 'https://your-ad-link.com'; // <-- গুরুত্বপূর্ণ: আপনার লিঙ্ক অ্যাডের URL দিন

        // --- AD WIDGET INITIALIZATION ---
        const adexiumWidget = new AdexiumWidget({wid: '58c10430-460c-471a-a10d-37f668f9452e'});
        
        let appState = {}; 
        const loader = document.getElementById('loader');
        const container = document.querySelector('.container');

        document.addEventListener('DOMContentLoaded', async () => {
            try {
                const userData = await fetchUserData(); 
                if (userData) {
                    appState = userData;
                    initializeUI();
                    container.style.display = 'block';
                } else {
                    showToast('Failed to load user data. Please restart.');
                }
            } catch (error) {
                console.error('Initialization failed:', error);
                showToast('An error occurred. Please try again.');
            } finally {
                loader.style.display = 'none';
            }
        });

        // --- API FUNCTIONS (Backend Communication) ---
        async function fetchUserData() {
            // Dummy data for demonstration. REPLACE WITH YOUR ACTUAL API CALL.
            return {
                balance: 140, totalEarnings: 140, adsWatched: 7, dailyTasksCompleted: 7, dailyTaskLimit: 50,
                totalReferrals: 0, totalWithdrawals: 0, userId: tg.initDataUnsafe?.user?.id || '12345'
            };
        }

        async function claimAdReward(buttonElement) {
            const originalContent = buttonElement.innerHTML;
            buttonElement.disabled = true;
            buttonElement.innerHTML = `<div class="loader" style="width:20px;height:20px;border-width:2px;"></div>`;
            
            try {
                // Dummy logic for demonstration. REPLACE WITH YOUR ACTUAL API CALL.
                const reward = 10;
                appState.balance += reward;
                appState.totalEarnings += reward;
                appState.adsWatched++;
                appState.dailyTasksCompleted++;
                updateUI();
                showToast(`+${reward} Points! Task completed.`);
                tg.HapticFeedback.notificationOccurred('success');
            } catch(error) {
                console.error("Error claiming reward:", error);
                showToast('Failed to claim reward. Try again.');
            } finally {
                buttonElement.disabled = false;
                buttonElement.innerHTML = originalContent;
                updateAllButtonStates(); // Update states for all buttons after one task
            }
        }
        
        // --- UI INITIALIZATION & UPDATES ---
        function initializeUI() {
            setupNavigation();
            setupEventListeners();
            updateUI();
        }

        function updateUI() {
            // General UI updates for balance, profile, etc. (code is omitted for brevity as it's unchanged)
            const progress = (appState.dailyTasksCompleted / appState.dailyTaskLimit) * 100;
            document.getElementById('progressBar').style.width = `${progress}%`;
            document.getElementById('earnProgressBar').style.width = `${progress}%`;
            
            const remaining = appState.dailyTaskLimit - appState.dailyTasksCompleted;
            document.getElementById('dailyTasksCompleted').textContent = appState.dailyTasksCompleted;
            document.getElementById('dailyTaskLimit').textContent = appState.dailyTaskLimit;
            document.getElementById('earnDailyTasksRemaining').textContent = remaining;

            updateAllButtonStates();
        }

        function updateAllButtonStates() {
            const remaining = appState.dailyTaskLimit - appState.dailyTasksCompleted;
            const buttons = [document.getElementById('popUpAdBtn'), document.getElementById('linkAdBtn')];
            
            buttons.forEach(btn => {
                if (remaining <= 0) {
                    btn.disabled = true;
                    // Keep original icon but change text
                    const icon = btn.querySelector('svg');
                    btn.innerHTML = (icon ? icon.outerHTML : '') + '<span>Daily Limit Reached</span>';
                } else {
                    btn.disabled = false;
                }
            });
        }

        // --- NAVIGATION ---
        function setupNavigation() {
            const navContainer = document.querySelector('.bottom-nav');
            const navItems = [
                { id: 'homePage', label: 'Home', icon: '<path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>' },
                { id: 'earnPage', label: 'Earn', icon: '<path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 14H9V8h2v8zm4 0h-2V8h2v8z"/>' },
                { id: 'withdrawPage', label: 'Withdraw', icon: '<path d="M20 4H4c-1.11 0-1.99.89-1.99 2L2 18c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V6c0-1.11-.89-2-2-2zm-1 14H5c-.55 0-1-.45-1-1V8h16v9c0 .55-.45 1-1 1z"/><path d="M19 8H5V6h14v2z"/>' },
                { id: 'support', label: 'Support', icon: '<path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-2 12H6v-2h12v2zm0-3H6V9h12v2zm0-3H6V6h12v2z"/>'},
                { id: 'profilePage', label: 'Profile', icon: '<path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>' }
            ];

            navItems.forEach(item => {
                const navEl = document.createElement('div');
                navEl.className = 'nav-item';
                if (item.id === 'homePage') navEl.classList.add('active');
                navEl.dataset.page = item.id;
                navEl.innerHTML = `<svg viewBox="0 0 24 24">${item.icon}</svg><div class="nav-label">${item.label}</div>`;
                navEl.addEventListener('click', () => navigateTo(item.id));
                navContainer.appendChild(navEl);
            });
        }

        function navigateTo(pageId) {
            if (pageId === 'support') {
                tg.openTelegramLink(supportLink);
                return;
            }
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            
            document.querySelectorAll('.nav-item').forEach(n => {
                n.classList.remove('active');
                if (n.dataset.page === pageId) {
                    n.classList.add('active');
                }
            });
        }

        // --- EVENT LISTENERS ---
        function setupEventListeners() {
            let adRotationIndex = 0;
            const popUpAdBtn = document.getElementById('popUpAdBtn');
            const linkAdBtn = document.getElementById('linkAdBtn');

            // Array of functions for each ad provider
            const adProviders = [
                () => window.showGiga(),
                () => show_9726274('pop'),
                () => adexiumWidget.show() 
            ];
            
            popUpAdBtn.addEventListener('click', () => {
                if (appState.dailyTasksCompleted >= appState.dailyTaskLimit) return;

                adProviders[adRotationIndex]()
                    .then(() => claimAdReward(popUpAdBtn))
                    .catch(e => {
                        console.error("Ad failed:", e);
                        showToast('Ad failed to load. Please try again.');
                    });
                
                // Rotate to the next provider for the next click
                adRotationIndex = (adRotationIndex + 1) % adProviders.length;
            });

            linkAdBtn.addEventListener('click', () => {
                if (appState.dailyTasksCompleted >= appState.dailyTaskLimit) return;
                
                // WARNING: This is not a secure way to reward link ads.
                // A backend with a callback/token system is required for verification.
                // For now, we open the link and grant the reward.
                tg.openLink(linkAdUrl);
                claimAdReward(linkAdBtn);
            });
        }

        // --- UTILITY FUNCTIONS ---
        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            setTimeout(() => { toast.classList.remove('show'); }, 3000);
        }

        // Mock functions for missing pages to avoid errors
        if (!document.getElementById('withdrawPage')) {
            const placeholder = document.createElement('div');
            placeholder.id = 'withdrawPage';
            placeholder.className = 'page';
            document.querySelector('.container').appendChild(placeholder);
        }
         if (!document.getElementById('profilePage')) {
            const placeholder = document.createElement('div');
            placeholder.id = 'profilePage';
            placeholder.className = 'page';
            document.querySelector('.container').appendChild(placeholder);
        }

    </script>
</body>
    </html>
